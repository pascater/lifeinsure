<!DOCTYPE html>
<html  lang="it">
<head>
  
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:image:src" content="assets/images/page7-last-modified-meta.png">
  <meta property="og:image" content="assets/images/page7-last-modified-meta.png">
  <meta name="twitter:title" content="Page 7 bis richiesta offerta last">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/lifeinsure-1-172x172.png" type="image/x-icon">
  <meta name="description" content="Richiesta di offerta polizza vita decesso caso morte in Svizzera Ticino">
  
  
  <title>Page 7 bis richiesta offerta last</title>
  <link rel="stylesheet" href="assets/Material-Design-Icons/css/material.css">
  <link rel="stylesheet" href="assets/icon54/style.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/web/assets/gdpr-plugin/gdpr-styles.css">
  <link rel="stylesheet" href="assets/popup-overlay-plugin/style.css">
    <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/socicon/css/styles.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Space+Grotesk:300,400,500,600,700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Space+Grotesk:300,400,500,600,700&display=swap"></noscript>
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">

  
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>
  
  <section data-bs-version="5.1" class="inspirem5 menu menu1 cid-uIlLmPtYKX" once="menu" id="menu01-3v">
    

    <nav class="navbar navbar-dropdown navbar-fixed-top navbar-expand-lg">
        <div class="container-fluid">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="index.html#top">
                        <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="" style="height: 3.6rem;" loading="lazy" class="lazyload" data-src="assets/images/lifeinsure-1-172x172.png">
                    </a>
                </span>
                
            </div>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbarSupportedContent" data-bs-target="#navbarSupportedContent" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav nav-dropdown" data-app-modern-menu="true"><li class="nav-item"><a class="nav-link link text-primary display-7" href="index.html#header01-2">Home</a></li>
                    <li class="nav-item dropdown"><a class="nav-link link text-primary dropdown-toggle display-7" href="index.html#features01-1" data-toggle="dropdown-submenu" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">Polizza decesso</a><div class="dropdown-menu" aria-labelledby="dropdown-707"><a class="text-primary dropdown-item display-7" href="index.html#progress-bars02-0">Vantaggi</a><a class="text-primary show dropdown-item display-7" href="index.html#progress-bars01-j">Valore</a><a class="text-primary show dropdown-item display-7" href="#" data-toggle="modal" data-bs-toggle="modal" data-target="#mbr-popup-2k" data-bs-target="#mbr-popup-2k"><span class="mdi-content-markunread mbr-iconfont mbr-iconfont-btn"></span>Una storia vera (leggi)</a><a class="text-primary show dropdown-item display-7" href="index.html#testimonials04-g">Testimonianze</a></div>
                    </li>
                    <li class="nav-item"><a class="nav-link link text-primary display-7" href="index.html#forms03-5">Chi siamo</a>
                    </li>
                    <li class="nav-item"><a class="nav-link link text-primary display-7" href="index.html#forms03-5">Contatti</a>
                    </li><li class="nav-item dropdown"><a class="nav-link link text-primary dropdown-toggle show display-7" href="index.html#forms03-5" data-toggle="dropdown-submenu" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false"><span class="icon54-v1-translate2 mbr-iconfont mbr-iconfont-btn"></span></a><div class="dropdown-menu show" aria-labelledby="dropdown-852" data-bs-popper="none"><a class="text-primary dropdown-item display-7" href="https://de.lifeinsure.ch" target="_blank">Deutsch</a><a class="text-primary dropdown-item display-7" href="https://fr.lifeinsure.ch" target="_blank">Fran√ßais</a></div></li></ul>
                
                <div class="navbar-buttons mbr-section-btn"><a class="btn btn-lg btn-danger display-4" href="index.html#features04-2"><span class="icon54-v1-click-1 mbr-iconfont mbr-iconfont-btn"></span>PREVENTIVO&nbsp;</a></div>
            </div>
        </div>
    </nav>
</section>

<section data-bs-version="5.1" class="inspirem5 header3 cid-uIlLmQ03HE" id="header03-3w">

    

    
    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-11">
                
                
                
                
            </div>
        </div>
    </div>
</section>

<div id="custom-html-3x">
<div id="custom-html-3r"><div id="custom-html-3k">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Richiesta Offerta Polizza Vita - Squarelife</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <style>
    .form-section {
      display: none;
    }
    .form-section.active {
      display: block;
    }
    .progress {
      height: 8px;
      margin-bottom: 30px;
    }
    .step-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .step {
      text-align: center;
      flex: 1;
      position: relative;
    }
    .step-number {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #dee2e6;
      color: #6c757d;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 5px;
      font-weight: bold;
    }
    .step.active .step-number {
      background-color: #0d6efd;
      color: white;
    }
    .step.completed .step-number {
      background-color: #198754;
      color: white;
    }
    .step-title {
      font-size: 0.8rem;
      color: #6c757d;
    }
    .step.active .step-title {
      color: #0d6efd;
      font-weight: bold;
    }
    .step.completed .step-title {
      color: #198754;
    }
    .required-field::after {
      content: "*";
      color: red;
      margin-left: 4px;
    }
    .subtitle {
      background-color: #f8f9fa;
      padding: 10px 15px;
      margin: 20px 0 15px;
      border-left: 4px solid #0d6efd;
      font-size: 1.1rem;
    }
    .info-icon {
      color: #6c757d;
      cursor: pointer;
      margin-left: 5px;
    }
    .is-invalid {
      border-color: #dc3545;
    }
    .invalid-feedback {
      display: none;
      color: #dc3545;
      font-size: 0.875em;
      margin-top: 0.25rem;
    }
    .show-error .is-invalid + .invalid-feedback {
      display: block;
    }
    .show-error input:invalid,
    .show-error select:invalid,
    .show-error textarea:invalid {
      border-color: #dc3545;
    }
    .conditional-field {
      margin-top: 1rem;
      padding: 1rem;
      border-left: 3px solid #0d6efd;
      background-color: #f8f9fa;
    }
    @media (max-width: 767px) {
      .step-title {
        display: none;
      }
    }
    .thank-you-message {
      display: none;
      text-align: center;
      padding: 30px 0;
    }
    .thank-you-message.active {
      display: block;
    }
    /* Nuovi stili */
    .radio-error {
      border-left: 3px solid #dc3545;
      padding-left: 10px;
      background-color: rgba(220, 53, 69, 0.05);
    }
    .radio-error-message {
      color: #dc3545;
      font-size: 0.875em;
      margin-top: 0.25rem;
      display: block !important;
    }
    .beneficiary-container {
      background-color: rgba(13, 110, 253, 0.05);
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 4px;
    }
  </style>

  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Richiesta Offerta Polizza Vita</h4>
          </div>
          <div class="card-body">
            <!-- Indicatore progressione -->
            <div class="step-indicator mb-4">
              <div class="step active" id="step-1">
                <div class="step-number">1</div>
                <div class="step-title">Dati personali</div>
              </div>
              <div class="step" id="step-2">
                <div class="step-number">2</div>
                <div class="step-title">Questionario medico</div>
              </div>
              <div class="step" id="step-3">
                <div class="step-number">3</div>
                <div class="step-title">Beneficiari e conferma</div>
              </div>
            </div>

            <div class="progress">
              <div class="progress-bar" role="progressbar" style="width: 33%" aria-valuenow="33" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <form id="offer-request-form" novalidate="">
              <!-- STEP 1: Dati personali -->
              <div class="form-section active" id="section-1">
                <div class="subtitle">Dati personali</div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="firstname" class="form-label required-field">Nome</label>
                    <input type="text" class="form-control" id="firstname" name="firstname" required="">
                    <div class="invalid-feedback">
                      Inserisci il tuo nome
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="lastname" class="form-label required-field">Cognome</label>
                    <input type="text" class="form-control" id="lastname" name="lastname" required="">
                    <div class="invalid-feedback">
                      Inserisci il tuo cognome
                    </div>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="gender" class="form-label required-field">Genere</label>
                    <select class="form-select" id="gender" name="gender" required="">
                      <option value="" selected="" disabled="">
                        Seleziona...
                      </option>
                      <option value="M">Maschile</option>
                      <option value="F">Femminile</option>
                    </select>
                    <div class="invalid-feedback">
                      Seleziona il tuo genere
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="birthdate" class="form-label required-field">Data di nascita</label>
                    <input type="date" class="form-control" id="birthdate" name="birthdate" required="">
                    <div class="invalid-feedback">
                      Inserisci la tua data di nascita
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="street" class="form-label required-field">Indirizzo</label>
                  <input type="text" class="form-control" id="street" name="street" required="">
                  <div class="invalid-feedback">
                    Inserisci il tuo indirizzo
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-4">
                    <label for="zip" class="form-label required-field">CAP</label>
                    <input type="text" class="form-control" id="zip" name="zip" required="">
                    <div class="invalid-feedback">Inserisci il tuo CAP</div>
                  </div>
                  <div class="col-md-4">
                    <label for="city" class="form-label required-field">Citt√†</label>
                    <input type="text" class="form-control" id="city" name="city" required="">
                    <div class="invalid-feedback">
                      Inserisci la tua citt√†
                    </div>
                  </div>
                  <div class="col-md-4">
                    <label for="country" class="form-label required-field">Paese</label>
                    <div class="input-group">
                      <input type="text" class="form-control" id="country" name="country" value="Svizzera" readonly="">
                      <input type="hidden" name="country_code" value="CH">
                      <span class="input-group-text"><i class="bi bi-flag"></i></span>
                    </div>
                    <small class="text-muted">Solo residenti in Svizzera</small>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="email" class="form-label required-field">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required="">
                    <div class="invalid-feedback">
                      Inserisci un indirizzo email valido
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="phone" class="form-label required-field">Telefono</label>
                    <input type="tel" class="form-control" id="phone" name="phone" required="">
                    <div class="invalid-feedback">
                      Inserisci un numero di telefono valido
                    </div>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="nationality" class="form-label required-field">Nazionalit√†</label>
                    <select class="form-select" id="nationality" name="nationality" required="">
                      <option value="CH" selected="">Svizzera</option>
                      <option value="IT">Italiana</option>
                      <option value="DE">Tedesca</option>
                      <option value="FR">Francese</option>
                      <option value="AT">Austriaca</option>
                    </select>
                    <div class="invalid-feedback">
                      Seleziona la tua nazionalit√†
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="profession" class="form-label required-field">Professione</label>
                    <input type="text" class="form-control" id="profession" name="profession" required="">
                    <div class="invalid-feedback">
                      Inserisci la tua professione
                    </div>
                  </div>
                </div>

                <div class="subtitle">Dettagli polizza</div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="duration" class="form-label required-field">Durata (anni)</label>
                    <input type="number" class="form-control" id="duration" name="duration" min="1" max="40" value="10" required="">
                    <div class="invalid-feedback">
                      Inserisci la durata in anni (minimo 1, massimo 40)
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="coverage" class="form-label required-field">Copertura (CHF)</label>
                    <input type="number" class="form-control" id="coverage" name="coverage" min="50000" max="1000000" step="10000" value="100000" required="">
                    <div class="invalid-feedback">
                      Inserisci un importo di copertura valido
                    </div>
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label for="mode" class="form-label required-field">Modalit√† di pagamento</label>
                    <select class="form-select" id="mode" name="mode" required="">
                      <option value="annual" selected="">Annuale</option>
                      <option value="monthly">Mensile</option>
                    </select>
                    <div class="invalid-feedback">
                      Seleziona la modalit√† di pagamento
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="payment_type" class="form-label required-field">Tipo di pagamento</label>
                    <select class="form-select" id="payment_type" name="payment_type" required="">
                      <option value="e-bill" selected="">E-Bill</option>
                      <option value="manual">Fattura con QR code</option>
                    </select>
                    <div class="invalid-feedback">
                      Seleziona il tipo di pagamento
                    </div>
                  </div>
                </div>

                <div class="d-flex justify-content-end mt-4">
                  <button type="button" id="next-1" class="btn btn-primary">
                    Avanti
                  </button>
                </div>
              </div>

              <!-- STEP 2: Questionario medico -->
              <div class="form-section" id="section-2">
                <div class="subtitle">Informazioni di salute</div>

                <div class="mb-3">
                  <label for="height" class="form-label required-field">Altezza (cm)</label>
                  <input type="number" class="form-control" id="height" name="height" min="100" max="250" required="">
                  <div class="invalid-feedback">
                    Inserisci un'altezza valida (tra 100 e 250 cm)
                  </div>
                </div>

                <div class="mb-3">
                  <label for="weight" class="form-label required-field">Peso (kg)</label>
                  <input type="number" class="form-control" id="weight" name="weight" min="30" max="200" required="">
                  <div class="invalid-feedback">
                    Inserisci un peso valido (tra 30 e 200 kg)
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Negli ultimi 2 anni hai fumato regolarmente o occasionalmente sigarette, sigari, pipa o sigarette elettroniche?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="smoker_yes" name="smoker" value="yes">
                    <label class="form-check-label" for="smoker_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="smoker_no" name="smoker" value="no">
                    <label class="form-check-label" for="smoker_no">No</label>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Hai gi√† altre assicurazioni sulla vita puro rischio decesso?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="existing_insurance_yes" name="existing_insurance" value="yes">
                    <label class="form-check-label" for="existing_insurance_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="existing_insurance_no" name="existing_insurance" value="no">
                    <label class="form-check-label" for="existing_insurance_no">No</label>
                  </div>

                  <div id="existing_insurance_details" class="conditional-field d-none">
                    <label for="existing_coverage" class="form-label">Copertura totale esistente (CHF)</label>
                    <input type="number" class="form-control" id="existing_coverage" name="existing_coverage">
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Hai assunto o ti sono stati prescritti farmaci per pi√π di 4 settimane consecutive negli ultimi 5 anni?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="medication_yes" name="medication" value="yes">
                    <label class="form-check-label" for="medication_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="medication_no" name="medication" value="no">
                    <label class="form-check-label" for="medication_no">No</label>
                  </div>

                  <div id="medication_details" class="conditional-field d-none">
                    <label class="form-label required-field">La malattia sottostante √® guarita senza conseguenze da almeno 2 anni?</label>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" id="medication_resolved_yes" name="medication_resolved" value="yes">
                      <label class="form-check-label" for="medication_resolved_yes">S√¨</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" id="medication_resolved_no" name="medication_resolved" value="no">
                      <label class="form-check-label" for="medication_resolved_no">No</label>
                    </div>
                    <div class="mt-2">
                      <label for="medication_description" class="form-label">Descrizione:</label>
                      <textarea class="form-control" id="medication_description" name="medication_description" rows="2"></textarea>
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Negli ultimi 5 anni hai avuto l'ipertensione?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="hypertension_yes" name="hypertension" value="yes">
                    <label class="form-check-label" for="hypertension_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="hypertension_no" name="hypertension" value="no">
                    <label class="form-check-label" for="hypertension_no">No</label>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Sei stato ricoverato in ospedale negli ultimi 10 anni?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="hospitalization_yes" name="hospitalization" value="yes">
                    <label class="form-check-label" for="hospitalization_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="hospitalization_no" name="hospitalization" value="no">
                    <label class="form-check-label" for="hospitalization_no">No</label>
                  </div>

                  <div id="hospitalization_details" class="conditional-field d-none">
                    <label class="form-label required-field">La malattia sottostante √® guarita senza conseguenze da almeno 2 anni?</label>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" id="hospitalization_resolved_yes" name="hospitalization_resolved" value="yes">
                      <label class="form-check-label" for="hospitalization_resolved_yes">S√¨</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" id="hospitalization_resolved_no" name="hospitalization_resolved" value="no">
                      <label class="form-check-label" for="hospitalization_resolved_no">No</label>
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">√à attualmente pianificato un esame (ECG, esami di laboratorio, ecografia, RMT, ecc.)?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="planned_exam_yes" name="planned_exam" value="yes">
                    <label class="form-check-label" for="planned_exam_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="planned_exam_no" name="planned_exam" value="no">
                    <label class="form-check-label" for="planned_exam_no">No</label>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Negli ultimi 5 anni hai assunto stupefacenti o droghe o sei stato consigliato o trattato per questo?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="drugs_yes" name="drugs" value="yes">
                    <label class="form-check-label" for="drugs_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="drugs_no" name="drugs" value="no">
                    <label class="form-check-label" for="drugs_no">No</label>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Ti √® mai stata diagnosticata un'infezione da HIV (test AIDS positivo) o sei in attesa del risultato?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="hiv_yes" name="hiv" value="yes">
                    <label class="form-check-label" for="hiv_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="hiv_no" name="hiv" value="no">
                    <label class="form-check-label" for="hiv_no">No</label>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Prevedi un soggiorno all'estero di durata superiore a 6 settimane nei prossimi 12 mesi? (Al di fuori di UE, Svizzera, Islanda, Norvegia, USA, Canada)</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="foreign_stay_yes" name="foreign_stay" value="yes">
                    <label class="form-check-label" for="foreign_stay_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="foreign_stay_no" name="foreign_stay" value="no">
                    <label class="form-check-label" for="foreign_stay_no">No</label>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Sei esposto a pericoli particolari nel lavoro o nel tempo libero? (es. manipolazione di esplosivi o armi, protezione personale, soggiorno in zone di crisi, gare automobilistiche, sport aerei, alpinismo, arrampicata, arti marziali, sport estremi, immersioni)</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="dangerous_hobby_yes" name="dangerous_hobby" value="yes">
                    <label class="form-check-label" for="dangerous_hobby_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="dangerous_hobby_no" name="dangerous_hobby" value="no">
                    <label class="form-check-label" for="dangerous_hobby_no">No</label>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Ricevi una pensione o un'indennit√† giornaliera dall'assicurazione invalidit√† o da un'assicurazione infortuni?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="pension_yes" name="pension" value="yes">
                    <label class="form-check-label" for="pension_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="pension_no" name="pension" value="no">
                    <label class="form-check-label" for="pension_no">No</label>
                  </div>
                </div>

                <div class="mb-3">
                  <label class="form-label required-field">Negli ultimi 5 anni, hai avuto assenze dal lavoro di oltre un mese per malattia?</label>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="work_absence_yes" name="work_absence" value="yes">
                    <label class="form-check-label" for="work_absence_yes">S√¨</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="work_absence_no" name="work_absence" value="no">
                    <label class="form-check-label" for="work_absence_no">No</label>
                  </div>

                  <div id="work_absence_details" class="conditional-field d-none">
                    <label class="form-label required-field">La condizione √® risolta da almeno 2 anni senza trattamenti?</label>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" id="work_absence_resolved_yes" name="work_absence_resolved" value="yes">
                      <label class="form-check-label" for="work_absence_resolved_yes">S√¨</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" id="work_absence_resolved_no" name="work_absence_resolved" value="no">
                      <label class="form-check-label" for="work_absence_resolved_no">No</label>
                    </div>
                  </div>
                </div>

                <div class="subtitle">Condizioni mediche</div>

                <div class="mb-3">
                  <label class="form-label">Negli ultimi 5 anni, hai sofferto di una delle seguenti condizioni?</label>

                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="heart_disease" name="conditions[]" value="heart_disease">
                    <label class="form-check-label" for="heart_disease">
                      Problemi cardiaci o infarto
                    </label>
                  </div>

                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="stroke" name="conditions[]" value="stroke">
                    <label class="form-check-label" for="stroke">
                      Ictus
                    </label>
                  </div>

                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="diabetes" name="conditions[]" value="diabetes">
                    <label class="form-check-label" for="diabetes">
                      Diabete
                    </label>
                  </div>

                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="cancer" name="conditions[]" value="cancer">
                    <label class="form-check-label" for="cancer">
                      Tumore
                    </label>
                  </div>

                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="respiratory" name="conditions[]" value="respiratory">
                    <label class="form-check-label" for="respiratory">
                      Problemi respiratori cronici (es. BPCO, enfisema)
                    </label>
                  </div>

                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="liver" name="conditions[]" value="liver">
                    <label class="form-check-label" for="liver">
                      Malattie del fegato
                    </label>
                  </div>

                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="kidney" name="conditions[]" value="kidney">
                    <label class="form-check-label" for="kidney">
                      Malattie renali
                    </label>
                  </div>
                  
                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="epilepsy" name="conditions[]" value="epilepsy">
                    <label class="form-check-label" for="epilepsy">
                      Epilessia
                    </label>
                  </div>
                  
                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="multiple_sclerosis" name="conditions[]" value="multiple_sclerosis">
                    <label class="form-check-label" for="multiple_sclerosis">
                      Sclerosi multipla
                    </label>
                  </div>
                  
                  <div class="form-check mb-2">
                    <input class="form-check-input condition-checkbox" type="checkbox" id="mental_health" name="conditions[]" value="mental_health">
                    <label class="form-check-label" for="mental_health">
                      Problemi di salute mentale
                    </label>
                  </div>

                  <div id="condition_details" class="conditional-field d-none">
                    <label for="condition_notes" class="form-label">Fornisci dettagli sulle condizioni selezionate:</label>
                    <textarea class="form-control" id="condition_notes" name="condition_notes" rows="3"></textarea>
                  </div>
                </div>

                <div class="d-flex justify-content-between mt-4">
                  <button type="button" id="prev-2" class="btn btn-secondary">Indietro</button>
                  <button type="button" id="next-2" class="btn btn-primary">Avanti</button>
                </div>
              </div>

              <!-- STEP 3: Beneficiari e Conferma -->
              <div class="form-section" id="section-3">
                <div class="subtitle">Beneficiari</div>

                <div class="row mb-3">
                  <div class="col-md-12">
                    <label for="beneficiary_type" class="form-label required-field">Tipo di beneficiario</label>
                    <select class="form-select" id="beneficiary_type" name="beneficiary_type" required="">
                      <option value="" selected="" disabled="">Seleziona...</option>
                      <option value="spouse">Coniuge</option>
                      <option value="children">Figli</option>
                      <option value="parents">Genitori</option>
                      <option value="other">Altro</option>
                    </select>
                    <div class="invalid-feedback">
                      Seleziona il tipo di beneficiario
                    </div>
                  </div>
                </div>

                <!-- Implementazione per i beneficiari multipli -->
                <div id="other_beneficiary" class="conditional-field d-none">
                  <div class="beneficiary-container" data-index="0">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h6 class="mb-0">Beneficiario #1</h6>
                      <button type="button" class="btn btn-sm btn-outline-danger remove-beneficiary d-none" data-index="0">
                        <i class="bi bi-trash"></i> Rimuovi
                      </button>
                    </div>
                    
                    <div class="row mb-3">
                      <div class="col-md-6">
                        <label for="beneficiary_firstname_0" class="form-label">Nome</label>
                        <input type="text" class="form-control" id="beneficiary_firstname_0" name="beneficiary_firstname_0">
                      </div>
                      <div class="col-md-6">
                        <label for="beneficiary_lastname_0" class="form-label">Cognome</label>
                        <input type="text" class="form-control" id="beneficiary_lastname_0" name="beneficiary_lastname_0">
                      </div>
                    </div>
                    
                    <div class="row mb-3">
                      <div class="col-md-8">
                        <label for="beneficiary_relation_0" class="form-label">Relazione con l'assicurato</label>
                        <input type="text" class="form-control" id="beneficiary_relation_0" name="beneficiary_relation_0">
                      </div>
                      <div class="col-md-4">
                        <label for="beneficiary_percentage_0" class="form-label">Percentuale (%)</label>
                        <input type="number" class="form-control beneficiary-percentage" id="beneficiary_percentage_0" name="beneficiary_percentage_0" min="1" max="100" value="100">
                      </div>
                    </div>
                    <hr>
                  </div>
                  
                  <!-- Template per nuovi beneficiari (sar√† nascosto) -->
                  <div id="beneficiary-template" style="display: none;">
                    <div class="beneficiary-container" data-index="{INDEX}">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Beneficiario #{NUMBER}</h6>
                        <button type="button" class="btn btn-sm btn-outline-danger remove-beneficiary" data-index="{INDEX}">
                          <i class="bi bi-trash"></i> Rimuovi
                        </button>
                      </div>
                      
                      <div class="row mb-3">
                        <div class="col-md-6">
                          <label for="beneficiary_firstname_{INDEX}" class="form-label">Nome</label>
                          <input type="text" class="form-control" id="beneficiary_firstname_{INDEX}" name="beneficiary_firstname_{INDEX}">
                        </div>
                        <div class="col-md-6">
                          <label for="beneficiary_lastname_{INDEX}" class="form-label">Cognome</label>
                          <input type="text" class="form-control" id="beneficiary_lastname_{INDEX}" name="beneficiary_lastname_{INDEX}">
                        </div>
                      </div>
                      
                      <div class="row mb-3">
                        <div class="col-md-8">
                          <label for="beneficiary_relation_{INDEX}" class="form-label">Relazione con l'assicurato</label>
                          <input type="text" class="form-control" id="beneficiary_relation_{INDEX}" name="beneficiary_relation_{INDEX}">
                        </div>
                        <div class="col-md-4">
                          <label for="beneficiary_percentage_{INDEX}" class="form-label">Percentuale (%)</label>
                          <input type="number" class="form-control beneficiary-percentage" id="beneficiary_percentage_{INDEX}" name="beneficiary_percentage_{INDEX}" min="1" max="100">
                        </div>
                      </div>
                      <hr>
                    </div>
                  </div>
                  
                  <!-- Avviso per la percentuale totale -->
                  <div class="alert alert-info mb-3" id="percentage-info">
                    Percentuale totale allocata: <strong id="total-percentage">100</strong>%
                  </div>
                  
                  <!-- Pulsante per aggiungere altri beneficiari -->
                  <div class="text-center mb-3">
                    <button type="button" id="add-beneficiary" class="btn btn-outline-primary">
                      <i class="bi bi-plus-circle"></i> Aggiungi beneficiario
                    </button>
                  </div>
                </div>

                <div class="subtitle">Consensi e Dichiarazioni</div>

                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="privacy_consent" name="privacy_consent" required="">
                    <label class="form-check-label required-field" for="privacy_consent">
                      Ho letto e acconsento all'informativa sulla privacy e al trattamento dei miei dati personali per le finalit√† indicate.
                    </label>
                    <div class="invalid-feedback">
                      Devi accettare l'informativa sulla privacy
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="terms_consent" name="terms_consent" required="">
                    <label class="form-check-label required-field" for="terms_consent">
                      Dichiaro che le informazioni fornite sono veritiere e complete e acconsento ai termini e condizioni del servizio.
                    </label>
                    <div class="invalid-feedback">
                      Devi accettare i termini e condizioni
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="mandate_consent" name="mandate_consent" required="">
                    <label class="form-check-label required-field" for="mandate_consent">
                      Conferisco mandato fiduciario per mediazione di servizi assicurativi a Lifensure SA.
                    </label>
                    <div class="invalid-feedback">
                      √à necessario conferire il mandato per procedere
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="marketing_consent" name="marketing_consent">
                    <label class="form-check-label" for="marketing_consent">
                      Acconsento a ricevere comunicazioni commerciali e promozionali anche da terze parti.
                    </label>
                  </div>
                </div>

                <div class="mb-4">
                  <label for="notes" class="form-label">Note aggiuntive (facoltativo)</label>
                  <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                </div>

                <div class="d-flex justify-content-between mt-4">
                  <button type="button" id="prev-3" class="btn btn-secondary">Indietro</button>
                  <button type="submit" id="submit-form" class="btn btn-success">Invia richiesta</button>
                </div>
              </div>
            </form>

            <!-- Messaggio di ringraziamento -->
            <div class="thank-you-message" id="thank-you">
              <div class="alert alert-success mb-4">
                <h4 class="alert-heading">Grazie per la tua richiesta!</h4>
                <p>La tua richiesta di offerta √® stata inviata con successo. Riceverai un'email di conferma all'indirizzo fornito.</p>
                <hr>
                <p class="mb-0">Un nostro consulente ti contatter√† entro 48 ore lavorative.</p>
              </div>
              <p>Numero di riferimento: <strong id="reference-number">-</strong></p>
              <button type="button" id="new-request" class="btn btn-primary mt-3">Nuova richiesta</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Elementi di navigazione
      const form = document.getElementById("offer-request-form");
      const sections = document.querySelectorAll(".form-section");
      const progressBar = document.querySelector(".progress-bar");
      const steps = document.querySelectorAll(".step");
      const thankYouMessage = document.getElementById("thank-you");
      
      // Bottoni di navigazione
      const nextBtn1 = document.getElementById("next-1");
      const nextBtn2 = document.getElementById("next-2");
      const prevBtn2 = document.getElementById("prev-2");
      const prevBtn3 = document.getElementById("prev-3");
      const submitBtn = document.getElementById("submit-form");
      const newRequestBtn = document.getElementById("new-request");
      
      // Elementi per campi condizionali
      const existingInsuranceRadios = document.querySelectorAll('input[name="existing_insurance"]');
      const existingInsuranceDetails = document.getElementById("existing_insurance_details");
      
      const workAbsenceRadios = document.querySelectorAll('input[name="work_absence"]');
      const workAbsenceDetails = document.getElementById("work_absence_details");
      
      const conditionCheckboxes = document.querySelectorAll('.condition-checkbox');
      const conditionDetails = document.getElementById("condition_details");
      
      const beneficiaryTypeSelect = document.getElementById("beneficiary_type");
      const otherBeneficiary = document.getElementById("other_beneficiary");
      
      const medicationRadios = document.querySelectorAll('input[name="medication"]');
      const medicationDetails = document.getElementById("medication_details");
      
      const hospitalizationRadios = document.querySelectorAll('input[name="hospitalization"]');
      const hospitalizationDetails = document.getElementById("hospitalization_details");
      
      // Variabili per la gestione dei beneficiari
      let beneficiaryCount = 1;
      let beneficiaryIndexes = [0]; // Tiene traccia degli indici dei beneficiari attivi
      
      // Funzione per generare un ID univoco
      function generateUniqueId() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          const r = Math.random() * 16 | 0;
          const v = c == 'x' ? r : (r & 0x3 | 0x8);
          return v.toString(16);
        });
      }
      
      // Funzione per navigare tra gli step
      function goToStep(stepNumber) {
        console.log("Navigating to step:", stepNumber);
        
        // Nascondi tutti gli step
        sections.forEach(section => {
          section.classList.remove("active");
        });
        
        // Mostra lo step corrente
        document.getElementById(`section-${stepNumber}`).classList.add("active");
        
        // Aggiorna gli indicatori di step
        steps.forEach(step => {
          step.classList.remove("active", "completed");
        });
        
        // Imposta lo step corrente come attivo
        document.getElementById(`step-${stepNumber}`).classList.add("active");
        
        // Imposta gli step precedenti come completati
        for (let i = 1; i < stepNumber; i++) {
          document.getElementById(`step-${i}`).classList.add("completed");
        }
        
        // Aggiorna la barra di avanzamento
        const progressPercentage = ((stepNumber - 1) / (sections.length - 1)) * 100;
        progressBar.style.width = progressPercentage + "%";
        progressBar.setAttribute("aria-valuenow", progressPercentage);
      }
      
      // Funzione per validare i campi di uno step
      function validateStep(stepNumber) {
        const sectionId = `section-${stepNumber}`;
        const stepSection = document.getElementById(sectionId);
        const requiredFields = stepSection.querySelectorAll("[required]");
        let isValid = true;
        
        requiredFields.forEach(field => {
          if (!field.value || (field.type === "checkbox" && !field.checked)) {
            field.classList.add("is-invalid");
            isValid = false;
          } else {
            field.classList.remove("is-invalid");
          }
        });
        
        if (!isValid) {
          stepSection.classList.add("show-error");
        }
        
        return isValid;
      }
      
      // Funzione per validare i radio button
      function validateRadioGroups() {
        const section = document.getElementById("section-2");
        const radioGroups = {};
        
        // Raccogli tutti i gruppi di radio nel questionario medico
        section.querySelectorAll('input[type="radio"]').forEach(radio => {
          if (!radioGroups[radio.name]) {
            radioGroups[radio.name] = [];
          }
          radioGroups[radio.name].push(radio);
        });
        
        let isValid = true;
        
        // Verifica che ogni gruppo abbia almeno un'opzione selezionata
        for (const name in radioGroups) {
          // Ignora i gruppi che sono in campi condizionali nascosti
          const firstRadio = radioGroups[name][0];
          const radioContainer = firstRadio.closest('.mb-3');
          const parentContainer = firstRadio.closest('.conditional-field');
          if (parentContainer && parentContainer.classList.contains('d-none')) {
            continue;
          }
          
          const isChecked = radioGroups[name].some(radio => radio.checked);
          
          // Evidenzia il gruppo non selezionato
          if (!isChecked) {
            isValid = false;
            
            if (radioContainer) {
              // Aggiungi classe per evidenziare l'errore
              radioContainer.classList.add('radio-error');
              
              // Crea o aggiorna il messaggio di errore
              let errorMsg = radioContainer.querySelector('.radio-error-message');
              if (!errorMsg) {
                errorMsg = document.createElement('div');
                errorMsg.className = 'invalid-feedback radio-error-message d-block';
                errorMsg.textContent = 'Seleziona una risposta';
                radioContainer.appendChild(errorMsg);
              }
            }
          } else {
            // Rimuovi l'evidenziazione dell'errore se ora √® valido
            if (radioContainer) {
              radioContainer.classList.remove('radio-error');
              const errorMsg = radioContainer.querySelector('.radio-error-message');
              if (errorMsg) {
                errorMsg.remove();
              }
            }
          }
        }
        
        return isValid;
      }
      
      // Funzione per determinare se un elemento √® realmente visibile
      function isElementVisible(el) {
        if (!el) return false;
        
        // Verifica lo stile dell'elemento
        const style = window.getComputedStyle(el);
        if (style.display === 'none' || style.visibility === 'hidden') return false;
        
        // Verifica la classe d-none
        if (el.classList.contains('d-none')) return false;
        
        // Verifica ricorsivamente i genitori
        if (el.parentElement && el.parentElement !== document.body) {
          return isElementVisible(el.parentElement);
        }
        
        return true;
      }
      
      // Funzione per ottenere tutti gli input percentuali visibili
      function getVisiblePercentageInputs() {
        const allInputs = document.querySelectorAll('.beneficiary-percentage');
        return Array.from(allInputs).filter(input => {
          const container = input.closest('.beneficiary-container');
          return container && isElementVisible(container);
        });
      }
      
      // Funzione per aggiornare la percentuale totale
      function updateTotalPercentage() {
        const percentageInputs = getVisiblePercentageInputs();
        let total = 0;
        
        percentageInputs.forEach(input => {
          // Utilizza parseInt con base 10 per essere sicuri
          const value = parseInt(input.value, 10) || 0;
          total += value;
        });
        
        // Aggiorna il display del totale
        const totalPercentageEl = document.getElementById('total-percentage');
        if (totalPercentageEl) {
          totalPercentageEl.textContent = total;
        }
        
        // Aggiorna il colore dell'alert in base al totale
        const percentageInfo = document.getElementById('percentage-info');
        if (percentageInfo) {
          if (total === 100) {
            percentageInfo.className = 'alert alert-success mb-3';
          } else if (total < 100) {
            percentageInfo.className = 'alert alert-warning mb-3';
          } else { // total > 100
            percentageInfo.className = 'alert alert-danger mb-3';
          }
        }
        
        return total;
      }
      
      // Funzione per distribuire equamente le percentuali
      function distributePercentages() {
        const percentageInputs = getVisiblePercentageInputs();
        const count = percentageInputs.length;
        
        if (count === 0) return;
        
        // Calcola la distribuzione equa
        const basePercentage = Math.floor(100 / count);
        const remainder = 100 - (basePercentage * count);
        
        // Distribuisci le percentuali
        percentageInputs.forEach((input, index) => {
          // Aggiungi 1 ai primi 'remainder' beneficiari
          const percentage = basePercentage + (index < remainder ? 1 : 0);
          input.value = percentage;
        });
        
        // Aggiorna il totale visualizzato
        updateTotalPercentage();
      }
      
      // Gestione dei campi condizionali per assicurazioni esistenti
      existingInsuranceRadios.forEach((radio) => {
        radio.addEventListener("change", function() {
          if (this.value === "yes" && this.checked) {
            existingInsuranceDetails.classList.remove("d-none");
          } else {
            existingInsuranceDetails.classList.add("d-none");
          }
        });
      });
      
      // Gestione dei campi condizionali per assenze dal lavoro
      workAbsenceRadios.forEach((radio) => {
        radio.addEventListener("change", function() {
          if (this.value === "yes" && this.checked) {
            workAbsenceDetails.classList.remove("d-none");
          } else {
            workAbsenceDetails.classList.add("d-none");
          }
        });
      });
      
      // Gestione dei campi condizionali per i farmaci
      medicationRadios.forEach((radio) => {
        radio.addEventListener("change", function() {
          if (this.value === "yes" && this.checked) {
            medicationDetails.classList.remove("d-none");
          } else {
            medicationDetails.classList.add("d-none");
          }
        });
      });
      
      // Gestione dei campi condizionali per i ricoveri ospedalieri
      hospitalizationRadios.forEach((radio) => {
        radio.addEventListener("change", function() {
          if (this.value === "yes" && this.checked) {
            hospitalizationDetails.classList.remove("d-none");
          } else {
            hospitalizationDetails.classList.add("d-none");
          }
        });
      });
      
      // Gestione dei campi condizionali per le condizioni mediche
      conditionCheckboxes.forEach((checkbox) => {
        checkbox.addEventListener("change", function() {
          // Verifica se almeno una condizione √® selezionata
          const isAnyConditionSelected = Array.from(conditionCheckboxes).some(cb => cb.checked);
          
          if (isAnyConditionSelected) {
            conditionDetails.classList.remove("d-none");
          } else {
            conditionDetails.classList.add("d-none");
          }
        });
      });
      
      // Gestione del campo condizionale per beneficiari
      if (beneficiaryTypeSelect) {
        beneficiaryTypeSelect.addEventListener("change", function() {
          if (this.value === "other") {
            otherBeneficiary.classList.remove("d-none");
            // Imposta i campi obbligatori solo per il primo beneficiario
            document.getElementById("beneficiary_firstname_0").setAttribute("required", "");
            document.getElementById("beneficiary_lastname_0").setAttribute("required", "");
            // Aggiorna le percentuali quando si mostra per la prima volta
            setTimeout(updateTotalPercentage, 100);
          } else {
            otherBeneficiary.classList.add("d-none");
            // Rimuovi l'attributo required
            document.getElementById("beneficiary_firstname_0").removeAttribute("required");
            document.getElementById("beneficiary_lastname_0").removeAttribute("required");
          }
        });
      }
      
      // Aggiungi ascoltatori ai primi input di percentuale
      const firstPercentageInput = document.getElementById('beneficiary_percentage_0');
      if (firstPercentageInput) {
        firstPercentageInput.addEventListener('input', updateTotalPercentage);
      }
      
      // Aggiunta di un nuovo beneficiario
      const addBeneficiaryBtn = document.getElementById('add-beneficiary');
      if (addBeneficiaryBtn) {
        addBeneficiaryBtn.addEventListener('click', function() {
          beneficiaryCount++;
          // Usa timestamp per garantire l'unicit√† dell'indice
          const newIndex = Date.now();
          beneficiaryIndexes.push(newIndex);
          
          // Ottieni il template e sostituisci i placeholder
          const template = document.getElementById('beneficiary-template');
          if (!template) {
            console.error("Template beneficiario non trovato!");
            return;
          }
          
          let newHTML = template.innerHTML;
          newHTML = newHTML.replace(/{INDEX}/g, newIndex);
          newHTML = newHTML.replace(/{NUMBER}/g, beneficiaryCount);
          
          // Crea un elemento DOM temporaneo per estrarre il primo figlio
          const temp = document.createElement('div');
          temp.innerHTML = newHTML;
          const newBeneficiary = temp.firstElementChild;
          
          // Inserisci nel DOM
          const percentageInfo = document.getElementById('percentage-info');
          if (percentageInfo) {
            percentageInfo.parentNode.insertBefore(newBeneficiary, percentageInfo);
          }
          
          // Se √® il secondo beneficiario, mostra il pulsante di rimozione sul primo
          if (beneficiaryCount === 2) {
            const firstRemoveBtn = document.querySelector('.remove-beneficiary');
            if (firstRemoveBtn) {
              firstRemoveBtn.classList.remove('d-none');
            }
          }
          
          // Aggiungi listener all'input percentuale
          const newInput = document.getElementById(`beneficiary_percentage_${newIndex}`);
          if (newInput) {
            newInput.addEventListener('input', updateTotalPercentage);
          }
          
          // Configura i pulsanti di rimozione
          setupRemoveBeneficiaryButtons();
          
          // Distribuisci le percentuali
          distributePercentages();
        });
      }
      
      // Funzione per configurare i pulsanti di rimozione
      function setupRemoveBeneficiaryButtons() {
        document.querySelectorAll('.remove-beneficiary').forEach(btn => {
          // Clona il pulsante per rimuovere eventuali listener precedenti
          const newBtn = btn.cloneNode(true);
          if (btn.parentNode) {
            btn.parentNode.replaceChild(newBtn, btn);
          }
          
          // Aggiungi il nuovo listener
          newBtn.addEventListener('click', function() {
            const index = this.getAttribute('data-index');
            if (!index) {
              console.error("Indice mancante sul pulsante di rimozione!");
              return;
            }
            
            removeBeneficiary(index);
          });
        });
      }
      
      // Funzione per rimuovere un beneficiario
      function removeBeneficiary(index) {
        // Trova il container del beneficiario
        const container = document.querySelector(`.beneficiary-container[data-index="${index}"]`);
        if (!container) {
          console.error(`Beneficiario con indice ${index} non trovato!`);
          return;
        }
        
        // Rimuovi dal DOM
        container.remove();
        beneficiaryCount--;
        
        // Rimuovi l'indice dall'array
        const indexPosition = beneficiaryIndexes.indexOf(parseInt(index, 10));
        if (indexPosition !== -1) {
          beneficiaryIndexes.splice(indexPosition, 1);
        } else {
          // Prova a cercarlo come stringa
          const stringIndexPosition = beneficiaryIndexes.indexOf(index);
          if (stringIndexPosition !== -1) {
            beneficiaryIndexes.splice(stringIndexPosition, 1);
          } else {
            console.warn(`Indice ${index} non trovato nell'array degli indici!`);
          }
        }
        
        // Nascondi il pulsante di rimozione se c'√® solo un beneficiario
        if (beneficiaryCount === 1) {
          const firstRemoveBtn = document.querySelector('.remove-beneficiary');
          if (firstRemoveBtn) {
            firstRemoveBtn.classList.add('d-none');
          }
        }
        
        // Aggiorna la numerazione visibile
        document.querySelectorAll('.beneficiary-container').forEach((container, idx) => {
          const title = container.querySelector('h6');
          if (title) {
            title.textContent = `Beneficiario #${idx + 1}`;
          }
        });
        
        // Ridistribuisci le percentuali
        distributePercentages();
      }
      
      // Inizializza i pulsanti di rimozione
      setupRemoveBeneficiaryButtons();
      
      // Aggiungiamo handler per i pulsanti "Avanti" e "Indietro"
      if (nextBtn1) {
        nextBtn1.addEventListener("click", function() {
          if (validateStep(1)) {
            goToStep(2);
          }
        });
      }
      
      if (prevBtn2) {
        prevBtn2.addEventListener("click", function() {
          goToStep(1);
        });
      }
      
      if (nextBtn2) {
        nextBtn2.addEventListener("click", function() {
          if (validateStep(2) && validateRadioGroups()) {
            goToStep(3);
          } else if (!validateRadioGroups()) {
            // Scorri fino al primo errore
            const firstError = document.querySelector('.radio-error');
            if (firstError) {
              firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
          }
        });
      }
      
      if (prevBtn3) {
        prevBtn3.addEventListener("click", function() {
          goToStep(2);
        });
      }
      
      // Gestione dell'invio del form
      if (form) {
        form.addEventListener("submit", function(e) {
          e.preventDefault();
          
          if (validateStep(3)) {
            // Controllo per beneficiario di tipo "other"
            if (beneficiaryTypeSelect.value === 'other') {
              const totalPercentage = updateTotalPercentage();
              if (totalPercentage !== 100) {
                alert('La percentuale totale allocata ai beneficiari deve essere esattamente 100%');
                return;
              }
              
              // Aggiungi un campo nascosto con gli indici dei beneficiari
              const hiddenField = document.createElement('input');
              hiddenField.type = 'hidden';
              hiddenField.name = 'beneficiary_indexes';
              hiddenField.value = beneficiaryIndexes.join(',');
              form.appendChild(hiddenField);
            }
            
            // Verifica necessit√† di valutazione manuale
            const requiresManualVerification = checkIfRequiresManualVerification();
            
            // Aggiungi un campo nascosto per indicare la necessit√† di verifica manuale
            const manualVerificationField = document.createElement('input');
            manualVerificationField.type = 'hidden';
            manualVerificationField.name = 'requires_manual_verification';
            manualVerificationField.value = requiresManualVerification ? 'true' : 'false';
            form.appendChild(manualVerificationField);
            
            // Simula l'invio dei dati
            submitForm(requiresManualVerification);
          }
        });
      }
      
      // Funzione per verificare se √® necessaria una valutazione manuale
      function checkIfRequiresManualVerification() {
        // Controllo BMI
        const height = parseFloat(document.getElementById('height').value);
        const weight = parseFloat(document.getElementById('weight').value);
        
        if (height && weight) {
          const bmi = weight / ((height / 100) * (height / 100));
          const bmiValue = Math.round(bmi); // Arrotondamento commerciale
          
          if (bmiValue <= 18 || bmiValue > 41) {
            return true;
          }
        }
        
        // Controllo risposte "S√¨" nelle domande mediche
        const medicalQuestions = [
          "medication_yes", "hypertension_yes", "hospitalization_yes", 
          "planned_exam_yes", "drugs_yes", "hiv_yes", "foreign_stay_yes", 
          "dangerous_hobby_yes", "pension_yes", "work_absence_yes"
        ];
        
        for (const questionId of medicalQuestions) {
          const element = document.getElementById(questionId);
          if (element && element.checked) {
            return true;
          }
        }
        
        // Controllo condizioni mediche flaggate
        const medicalConditions = [
          "heart_disease", "stroke", "diabetes", "cancer", "respiratory",
          "liver", "kidney", "epilepsy", "multiple_sclerosis", "mental_health"
        ];
        
        for (const conditionId of medicalConditions) {
          const checkbox = document.getElementById(conditionId);
          if (checkbox && checkbox.checked) {
            return true;
          }
        }
        
        return false;
      }
      
      // Funzione per l'invio del form
      function submitForm(requiresManualVerification) {
        // Mostra spinner o messaggio di caricamento
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Invio in corso...';
        
        // Simula una richiesta asincrona
        setTimeout(function() {
          // Nascondi il form
          form.style.display = "none";
          
          // Genera e mostra un numero di riferimento
          const referenceNumber = generateUniqueId().substring(0, 8).toUpperCase();
          document.getElementById("reference-number").textContent = referenceNumber;
          
          // Mostra il messaggio di ringraziamento
          thankYouMessage.classList.add("active");
          
          // Nascondi gli indicatori di step
          document.querySelector(".step-indicator").style.display = "none";
          document.querySelector(".progress").style.display = "none";
          
          // Se √® necessaria la verifica manuale, personalizza il messaggio di ringraziamento
          if (requiresManualVerification) {
            const alertMessage = thankYouMessage.querySelector(".alert");
            alertMessage.className = "alert alert-info mb-4";
            alertMessage.innerHTML = `
              <h4 class="alert-heading">Richiesta inviata con successo!</h4>
              <p>La tua richiesta richiede una valutazione aggiuntiva da parte del nostro team.</p>
              <hr>
              <p class="mb-0">Un nostro consulente ti contatter√† entro 48 ore lavorative per procedere con la valutazione personalizzata.</p>
            `;
            
            // Salva l'informazione nella sessione
            sessionStorage.setItem("proceedToModule3", "false");
          } else {
            // Imposta il flag per procedere al modulo 3
            sessionStorage.setItem("proceedToModule3", "true");
            
            // Salva i dati per il passaggio al modulo 3
            sessionStorage.setItem("offerData", JSON.stringify({
              offerId: referenceNumber,
              email: document.getElementById("email").value
            }));
            
            // Aggiungi pulsante per procedere all'emissione
            const actionContainer = document.createElement("div");
            actionContainer.className = "mt-4";
            actionContainer.innerHTML = `
              <a href="emissione-polizza.html" class="btn btn-success">Procedi con l'emissione della polizza</a>
            `;
            thankYouMessage.appendChild(actionContainer);
          }
        }, 1500);
      }
      
      // Gestione del pulsante "Nuova richiesta"
      if (newRequestBtn) {
        newRequestBtn.addEventListener("click", function() {
          // Resetta il form
          form.reset();
          
          // Nascondi tutti i campi condizionali
          existingInsuranceDetails.classList.add("d-none");
          workAbsenceDetails.classList.add("d-none");
          conditionDetails.classList.add("d-none");
          otherBeneficiary.classList.add("d-none");
          medicationDetails.classList.add("d-none");
          hospitalizationDetails.classList.add("d-none");
          
          // Ripristina lo stato iniziale
          form.style.display = "block";
          thankYouMessage.classList.remove("active");
          document.querySelector(".step-indicator").style.display = "flex";
          document.querySelector(".progress").style.display = "block";
          
          // Rimuovi eventuali elementi aggiunti dinamicamente
          const actionContainer = thankYouMessage.querySelector(".mt-4");
          if (actionContainer) {
            actionContainer.remove();
          }
          
          // Torna al primo step
          goToStep(1);
          
          // Riabilita il pulsante di invio
          submitBtn.disabled = false;
          submitBtn.innerHTML = 'Invia richiesta';
        });
      }
      
      // Verifica se i dati preventivo sono stati passati dal modulo precedente
      function loadDataFromPreviousModule() {
        const datiPreventivoString = sessionStorage.getItem("datiPreventivo");
        
        if (datiPreventivoString) {
          try {
            const datiPreventivo = JSON.parse(datiPreventivoString);
            
            // Compila i campi della sezione "Dettagli polizza" con i dati recuperati
            if (datiPreventivo.durata) {
              const durationInput = document.getElementById("duration");
              if (durationInput) {
                durationInput.value = datiPreventivo.durata;
              }
            }
            
            if (datiPreventivo.copertura) {
              const coverageInput = document.getElementById("coverage");
              if (coverageInput) {
                coverageInput.value = datiPreventivo.copertura;
              }
            }
            
            // Compila anche i campi relativi ai dati fisici
            if (datiPreventivo.altezza) {
              const heightInput = document.getElementById("height");
              if (heightInput) {
                heightInput.value = datiPreventivo.altezza;
              }
            }
            
            if (datiPreventivo.peso) {
              const weightInput = document.getElementById("weight");
              if (weightInput) {
                weightInput.value = datiPreventivo.peso;
              }
            }
            
            if (datiPreventivo.fumatore !== undefined) {
              const smokerYes = document.getElementById("smoker_yes");
              const smokerNo = document.getElementById("smoker_no");
              if (smokerYes && smokerNo) {
                if (datiPreventivo.fumatore) {
                  smokerYes.checked = true;
                } else {
                  smokerNo.checked = true;
                }
              }
            }
            
            // Compila il campo data di nascita
            if (datiPreventivo.dataNascita) {
              const birthdateInput = document.getElementById("birthdate");
              if (birthdateInput) {
                birthdateInput.value = datiPreventivo.dataNascita;
              }
            }
            
            // Mostra un messaggio informativo sui dati recuperati
            const cardBody = document.querySelector(".card-body");
            if (cardBody) {
              const alertDiv = document.createElement("div");
              alertDiv.className = "alert alert-info alert-dismissible fade show mb-4";
              alertDiv.innerHTML = `
                <strong>Dati preventivo importati:</strong> Copertura: ${parseInt(datiPreventivo.copertura).toLocaleString()} ${datiPreventivo.currency || "CHF"}, 
                Durata: ${datiPreventivo.durata} anni, Premio: ${datiPreventivo.premio.toLocaleString()} ${datiPreventivo.currency || "CHF"}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Chiudi"></button>
              `;
              
              // Inserisci l'alert all'inizio della card-body, prima dell'indicatore di progressione
              const stepIndicator = document.querySelector(".step-indicator");
              if (stepIndicator) {
                cardBody.insertBefore(alertDiv, stepIndicator);
              } else {
                cardBody.prepend(alertDiv);
              }
            }
          } catch (error) {
            console.error("Errore durante il parsing dei dati preventivo:", error);
          }
        }
      }
      
      // Carica i dati dal modulo precedente, se disponibili
      loadDataFromPreviousModule();
    });
  </script>
</div></div>


<script src="https://r.mobirisesite.com/1342903/assets/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="https://r.mobirisesite.com/1342903/assets/smoothscroll/smooth-scroll.js"></script>
  <script src="https://r.mobirisesite.com/1342903/assets/ytplayer/index.js"></script>
      <script src="https://r.mobirisesite.com/1342903/assets/dropdown/js/navbar-dropdown.js"></script>
  <script src="https://r.mobirisesite.com/1342903/assets/theme/js/script.js"></script>
  
  
  <script src="https://r.mobirisesite.com/1342903/assets/js/api-handler.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const formPremio = document.getElementById('form-calcolo-premio');
    const risultatoPremio = document.getElementById('risultato-premio');
    
    if (formPremio) {
        formPremio.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Mostra l'area risultati e aggiungi indicatore di caricamento
            risultatoPremio.classList.remove('d-none');
            risultatoPremio.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Calcolo in corso...</span></div><p class="mt-2">Calcolo del premio in corso...</p></div>';
            
            // Raccogli dati dal form
            const dati = {
                dataNascita: document.getElementById('data-nascita').value,
                fumatore: document.getElementById('fumatore').checked,
                durata: document.getElementById('durata').value,
                copertura: document.getElementById('copertura').value,
                altezza: document.getElementById('altezza').value || null,
                peso: document.getElementById('peso').value || null
            };
            
            try {
                // Chiama l'API
                const risultato = await calcolaPremio(dati);
                
                // Mostra il risultato
                if (risultato.errore) {
                    risultatoPremio.innerHTML = `
                        <div class="alert alert-danger">
                            <h5>Si √® verificato un errore</h5>
                            <p>${risultato.errore}</p>
                        </div>`;
                } else {
                    // Estrai il premio dalla risposta
                    const premio = risultato.premium[0].yearly_gross_premium;
                    const currency = risultato.currency || 'CHF';
                    
                    risultatoPremio.innerHTML = `
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h4 class="card-title">Il tuo preventivo</h4>
                                <p class="card-text">In base ai dati forniti, il premio annuale √®:</p>
                                <h2 class="text-primary mb-4">${premio.toLocaleString()} ${currency}</h2>
                                <p class="small text-muted mb-3">Copertura: ${parseInt(dati.copertura).toLocaleString()} ${currency} | Durata: ${dati.durata} anni</p>
                                <button id="btn-richiedi-offerta" class="btn btn-success">Richiedi offerta completa</button>
                            </div>
                        </div>`;
                        
                    // Memorizza i dati per il passaggio successivo
                    sessionStorage.setItem('datiPreventivo', JSON.stringify({
                        ...dati,
                        premio: premio,
                        currency: currency
                    }));
                    
                    // Aggiungi listener al pulsante "Richiedi offerta"
                    document.getElementById('btn-richiedi-offerta').addEventListener('click', function() {
                        window.location.href = 'richiesta-offerta.html'; // Cambia con il percorso corretto alla tua pagina di offerta
                    });
                }
            } catch (errore) {
                risultatoPremio.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>Si √® verificato un errore durante la connessione</h5>
                        <p>Non √® stato possibile contattare il server. Riprova pi√π tardi.</p>
                        <p class="small text-muted">${errore.message}</p>
                    </div>`;
            }
        });
    }
});
</script></div>


<script src="assets/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/smoothscroll/smooth-scroll.js"></script>
  <script src="assets/ytplayer/index.js"></script>
      <script src="assets/dropdown/js/navbar-dropdown.js"></script>
  <script src="assets/theme/js/script.js"></script>
  
  
  <script src="assets/js/api-handler.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const formPremio = document.getElementById('form-calcolo-premio');
    const risultatoPremio = document.getElementById('risultato-premio');
    
    if (formPremio) {
        formPremio.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Mostra l'area risultati e aggiungi indicatore di caricamento
            risultatoPremio.classList.remove('d-none');
            risultatoPremio.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Calcolo in corso...</span></div><p class="mt-2">Calcolo del premio in corso...</p></div>';
            
            // Raccogli dati dal form
            const dati = {
                dataNascita: document.getElementById('data-nascita').value,
                fumatore: document.getElementById('fumatore').checked,
                durata: document.getElementById('durata').value,
                copertura: document.getElementById('copertura').value,
                altezza: document.getElementById('altezza').value || null,
                peso: document.getElementById('peso').value || null
            };
            
            try {
                // Chiama l'API
                const risultato = await calcolaPremio(dati);
                
                // Mostra il risultato
                if (risultato.errore) {
                    risultatoPremio.innerHTML = `
                        <div class="alert alert-danger">
                            <h5>Si √® verificato un errore</h5>
                            <p>${risultato.errore}</p>
                        </div>`;
                } else {
                    // Estrai il premio dalla risposta
                    const premio = risultato.premium[0].yearly_gross_premium;
                    const currency = risultato.currency || 'CHF';
                    
                    risultatoPremio.innerHTML = `
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h4 class="card-title">Il tuo preventivo</h4>
                                <p class="card-text">In base ai dati forniti, il premio annuale √®:</p>
                                <h2 class="text-primary mb-4">${premio.toLocaleString()} ${currency}</h2>
                                <p class="small text-muted mb-3">Copertura: ${parseInt(dati.copertura).toLocaleString()} ${currency} | Durata: ${dati.durata} anni</p>
                                <button id="btn-richiedi-offerta" class="btn btn-success">Richiedi offerta completa</button>
                            </div>
                        </div>`;
                        
                    // Memorizza i dati per il passaggio successivo
                    sessionStorage.setItem('datiPreventivo', JSON.stringify({
                        ...dati,
                        premio: premio,
                        currency: currency
                    }));
                    
                    // Aggiungi listener al pulsante "Richiedi offerta"
                    document.getElementById('btn-richiedi-offerta').addEventListener('click', function() {
                        window.location.href = 'richiesta-offerta.html'; // Cambia con il percorso corretto alla tua pagina di offerta
                    });
                }
            } catch (errore) {
                risultatoPremio.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>Si √® verificato un errore durante la connessione</h5>
                        <p>Non √® stato possibile contattare il server. Riprova pi√π tardi.</p>
                        <p class="small text-muted">${errore.message}</p>
                    </div>`;
            }
        });
    }
});
</script>
<script>"use strict";if("loading"in HTMLImageElement.prototype){document.querySelectorAll('img[loading="lazy"]').forEach(e=>{e.src=e.dataset.src;if(e.getAttribute("style")){e.setAttribute("data-temp-style",e.getAttribute("style"))};if(e.getAttribute("data-aspectratio")){e.style.paddingTop=100*e.getAttribute("data-aspectratio")+"%";e.style.height=0;}e.onload=function(){if(e.getAttribute("data-temp-style")){e.setAttribute("style", e.getAttribute("data-temp-style"))}else{e.removeAttribute("style")};e.removeAttribute("data-temp-style")}})}else{const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js";document.body.appendChild(e)}</script>

</body>
</html>