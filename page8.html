<!DOCTYPE html>
<html  lang="it">
<head>
  
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:image:src" content="assets/images/page8-meta.png">
  <meta property="og:image" content="assets/images/page8-meta.png">
  <meta name="twitter:title" content="Page 8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/lifeinsure-1-172x172.png" type="image/x-icon">
  <meta name="description" content="Calcolatore premio polizza vita decesso caso morte in Svizzera Ticino">
  
  
  <title>Page 8</title>
  <link rel="stylesheet" href="assets/Material-Design-Icons/css/material.css">
  <link rel="stylesheet" href="assets/icon54/style.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/web/assets/gdpr-plugin/gdpr-styles.css">
  <link rel="stylesheet" href="assets/popup-overlay-plugin/style.css">
    <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/socicon/css/styles.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Space+Grotesk:300,400,500,600,700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Space+Grotesk:300,400,500,600,700&display=swap"></noscript>
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">

  
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>
  
  <section data-bs-version="5.1" class="inspirem5 menu menu1 cid-uHcV8yKzqs" once="menu" id="menu01-3s">
    

    <nav class="navbar navbar-dropdown navbar-fixed-top navbar-expand-lg">
        <div class="container-fluid">
            <div class="navbar-brand">
                <span class="navbar-logo">
                    <a href="index.html#top">
                        <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="" style="height: 3.6rem;" loading="lazy" class="lazyload" data-src="assets/images/lifeinsure-1-172x172.png">
                    </a>
                </span>
                
            </div>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbarSupportedContent" data-bs-target="#navbarSupportedContent" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav nav-dropdown" data-app-modern-menu="true"><li class="nav-item"><a class="nav-link link text-primary display-7" href="index.html#header01-2">Home</a></li>
                    <li class="nav-item dropdown"><a class="nav-link link text-primary dropdown-toggle display-7" href="index.html#features01-1" data-toggle="dropdown-submenu" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">Polizza decesso</a><div class="dropdown-menu" aria-labelledby="dropdown-707"><a class="text-primary dropdown-item display-7" href="index.html#progress-bars02-0">Vantaggi</a><a class="text-primary show dropdown-item display-7" href="index.html#progress-bars01-j">Valore</a><a class="text-primary show dropdown-item display-7" href="#" data-toggle="modal" data-bs-toggle="modal" data-target="#mbr-popup-2k" data-bs-target="#mbr-popup-2k"><span class="mdi-content-markunread mbr-iconfont mbr-iconfont-btn"></span>Una storia vera (leggi)</a><a class="text-primary show dropdown-item display-7" href="index.html#testimonials04-g">Testimonianze</a></div>
                    </li>
                    <li class="nav-item"><a class="nav-link link text-primary display-7" href="index.html#forms03-5">Chi siamo</a>
                    </li>
                    <li class="nav-item"><a class="nav-link link text-primary display-7" href="index.html#forms03-5">Contatti</a>
                    </li><li class="nav-item dropdown"><a class="nav-link link text-primary dropdown-toggle show display-7" href="index.html#forms03-5" data-toggle="dropdown-submenu" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false"><span class="icon54-v1-translate2 mbr-iconfont mbr-iconfont-btn"></span></a><div class="dropdown-menu show" aria-labelledby="dropdown-852" data-bs-popper="none"><a class="text-primary dropdown-item display-7" href="https://de.lifeinsure.ch" target="_blank">Deutsch</a><a class="text-primary dropdown-item display-7" href="https://fr.lifeinsure.ch" target="_blank">Français</a></div></li></ul>
                
                <div class="navbar-buttons mbr-section-btn"><a class="btn btn-lg btn-danger display-4" href="index.html#features04-2"><span class="icon54-v1-click-1 mbr-iconfont mbr-iconfont-btn"></span>PREVENTIVO&nbsp;</a></div>
            </div>
        </div>
    </nav>
</section>

<section data-bs-version="5.1" class="inspirem5 header3 cid-uHcV8zftrL" id="header03-3t">

    

    
    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-11">
                
                
                
                
            </div>
        </div>
    </div>
</section>

<div id="custom-html-3u"><!-- Modulo emissione polizza con approccio robusto anti-conflitto -->
<div id="lifensure-emission-module" class="lifensure-container" style="display: block !important; visibility: visible !important; opacity: 1 !important;">
  <div class="lifensure-card" style="background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 25px; margin: 20px auto; max-width: 800px;">
    <h2 style="text-align: center; margin-bottom: 25px; color: #333; font-size: 24px;">Emissione Polizza Vita per decesso</h2>
    
    <!-- Barra di avanzamento -->
    <div style="height: 8px; background-color: #f0f0f0; border-radius: 4px; margin-bottom: 30px; overflow: hidden;">
      <div id="lifensure-progress-bar" style="height: 100%; width: 0%; background-color: #0d6efd; transition: width 0.3s ease;"></div>
    </div>
    
    <!-- STEP 1: Verifica Offerta -->
    <div id="lifensure-step-1" style="display: block;">
      <div style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; font-weight: bold;">
        Inserisci l'ID dell'offerta
      </div>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 500;">
          ID Offerta <span style="color: red;">*</span>
        </label>
        <input type="text" id="lifensure-offerta-id" placeholder="Es. ABCD1234" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 16px; box-sizing: border-box;">
        <div id="lifensure-offerta-id-error" style="color: #dc3545; font-size: 14px; margin-top: 5px; display: none;">
          Inserisci l'ID dell'offerta ricevuto via email
        </div>
        <div style="color: #6c757d; font-size: 14px; margin-top: 5px;">
          Inserisci l'ID dell'offerta che hai ricevuto al termine del processo di richiesta e via email
        </div>
      </div>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 500;">
          Email di conferma <span style="color: red;">*</span>
        </label>
        <input type="email" id="lifensure-email-conferma" placeholder="La tua email" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 16px; box-sizing: border-box;">
        <div id="lifensure-email-error" style="color: #dc3545; font-size: 14px; margin-top: 5px; display: none;">
          Inserisci un indirizzo email valido
        </div>
        <div style="color: #6c757d; font-size: 14px; margin-top: 5px;">
          Inserisci l'email utilizzata durante la richiesta dell'offerta
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 30px;">
        <button id="lifensure-verifica-btn" style="background-color: #0d6efd; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px; cursor: pointer;">
          Vai al riepilogo della tua offerta
        </button>
      </div>
    </div>
    
    <!-- STEP 2: Riepilogo -->
    <div id="lifensure-step-2" style="display: none;">
      <div style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; font-weight: bold;">
        Riepilogo dell'offerta
      </div>
      
      <div id="lifensure-riepilogo-content" style="margin-bottom: 25px; background-color: #f8f9fa; padding: 15px; border-radius: 4px;">
        <!-- Contenuto del riepilogo inserito dinamicamente -->
      </div>
      
      <div style="margin-bottom: 15px;">
        <div style="display: flex; align-items: start; margin-bottom: 10px;">
          <input type="checkbox" id="lifensure-condizioni-check" style="margin-right: 10px; margin-top: 3px;">
          <label for="lifensure-condizioni-check" style="font-size: 16px;">
            Ho letto e accetto le <a href="#" id="lifensure-condizioni-link" style="color: #0d6efd; text-decoration: none;">condizioni generali di assicurazione</a>
          </label>
        </div>
        <div id="lifensure-condizioni-error" style="color: #dc3545; font-size: 14px; margin-top: 5px; display: none;">
          Devi accettare le condizioni generali per procedere
        </div>
      </div>
      
      <div style="margin-bottom: 15px;">
        <div style="display: flex; align-items: start; margin-bottom: 10px;">
          <input type="checkbox" id="lifensure-privacy-check" style="margin-right: 10px; margin-top: 3px;">
          <label for="lifensure-privacy-check" style="font-size: 16px;">
            Ho letto l'<a href="#" id="lifensure-privacy-link" style="color: #0d6efd; text-decoration: none;">informativa sulla privacy</a> e acconsento al trattamento dei miei dati
          </label>
        </div>
        <div id="lifensure-privacy-error" style="color: #dc3545; font-size: 14px; margin-top: 5px; display: none;">
          Devi accettare l'informativa sulla privacy per procedere
        </div>
      </div>
      
      <div style="margin-bottom: 15px;">
        <div style="display: flex; align-items: start; margin-bottom: 10px;">
          <input type="checkbox" id="lifensure-dichiarazione-check" style="margin-right: 10px; margin-top: 3px;">
          <label for="lifensure-dichiarazione-check" style="font-size: 16px;">
            Dichiaro che tutte le informazioni fornite sono veritiere e complete
          </label>
        </div>
        <div id="lifensure-dichiarazione-error" style="color: #dc3545; font-size: 14px; margin-top: 5px; display: none;">
          Devi confermare che le informazioni fornite sono veritiere
        </div>
      </div>
      
      <div id="lifensure-domande-aggiuntive">
        <!-- Domande di underwriting inserite dinamicamente -->
      </div>
      
      <div style="display: flex; justify-content: space-between; margin-top: 30px;">
        <button id="lifensure-indietro-riepilogo" style="background-color: #f8f9fa; color: #333; border: 1px solid #ced4da; padding: 10px 20px; border-radius: 4px; font-size: 16px; cursor: pointer;">
          Indietro
        </button>
        <button id="lifensure-procedi-btn" style="background-color: #0d6efd; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px; cursor: pointer;">
          Procedi con l'emissione del certificato di polizza
        </button>
      </div>
    </div>
    
    <!-- STEP 3: Pagamento -->
    <div id="lifensure-step-3" style="display: none;">
      <div style="border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; font-weight: bold;">
        Pagamento
      </div>
      
      <div style="background-color: #cfe2ff; color: #084298; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
        <div style="display: flex; align-items: center;">
          <span style="margin-right: 10px;">ⓘ</span>
          <span>Il primo premio deve essere pagato per completare l'attivazione della polizza</span>
        </div>
      </div>
      
      <div id="lifensure-riepilogo-pagamento" style="margin-bottom: 25px; background-color: #f8f9fa; padding: 15px; border-radius: 4px;">
        <!-- Contenuto del riepilogo pagamento inserito dinamicamente -->
      </div>
      
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 500;">
          Metodo di pagamento <span style="color: red;">*</span>
        </label>
        <select id="lifensure-metodo-pagamento" style="width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 16px; box-sizing: border-box;">
          <option value="" selected="" disabled="">Seleziona il metodo di pagamento...</option>
          <option value="e-bill">E-Bill</option>
          <option value="bonifico">Fattura con QR Code</option>
        </select>
        <div id="lifensure-pagamento-error" style="color: #dc3545; font-size: 14px; margin-top: 5px; display: none;">
          Seleziona un metodo di pagamento
        </div>
      </div>
      
      <div id="lifensure-dati-ebill" style="display: none; margin-bottom: 20px; background-color: #f8f9fa; padding: 15px; border-radius: 4px;">
        <p style="margin-bottom: 10px;">Riceverai le istruzioni per configurare il pagamento all'indirizzo email indicato.</p>
        <small style="color: #6c757d;">Il documento di polizza verrà generato dopo la conferma del pagamento.</small>
      </div>
      
      <div id="lifensure-dati-bonifico" style="display: none; margin-bottom: 20px; background-color: #f8f9fa; padding: 15px; border-radius: 4px;">
        <h6 style="font-weight: 600; margin-bottom: 10px;">Dati per il bonifico:</h6>
        <p style="margin-bottom: 5px;">Intestatario: Squarelife Assicurazioni</p>
        <p style="margin-bottom: 5px;">IBAN: CH52 0483 5123 4567 8900 1</p>
        <p style="margin-bottom: 10px;">Causale: <span id="lifensure-causale-bonifico">Polizza [numero]</span></p>
        <small style="color: #6c757d;">Il documento di polizza verrà generato dopo la conferma del pagamento.</small>
      </div>
      
      <div style="display: flex; justify-content: space-between; margin-top: 30px;">
        <button id="lifensure-indietro-pagamento" style="background-color: #f8f9fa; color: #333; border: 1px solid #ced4da; padding: 10px 20px; border-radius: 4px; font-size: 16px; cursor: pointer;">
          Indietro
        </button>
        <button id="lifensure-conferma-pagamento" style="background-color: #198754; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px; cursor: pointer;">
          Conferma pagamento
        </button>
      </div>
    </div>
    
    <!-- STEP 4: Completamento -->
    <div id="lifensure-step-4" style="display: none;">
      <div style="text-align: center; margin-bottom: 30px;">
        <div style="width: 80px; height: 80px; margin: 0 auto; margin-bottom: 20px; border-radius: 50%; border: 4px solid #28a745; position: relative;">
          <div style="position: absolute; top: 20px; left: 20px; width: 40px; height: 25px; border-left: 4px solid #28a745; border-bottom: 4px solid #28a745; transform: rotate(-45deg);"></div>
        </div>
        <h3 style="color: #28a745; font-size: 22px; margin-bottom: 10px;">Emissione completata!</h3>
        <p style="font-size: 16px;">La tua polizza è stata emessa con successo</p>
      </div>
      
      <div style="background-color: #d1e7dd; color: #0f5132; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
        <h5 style="margin-bottom: 5px; font-weight: 600;">Numero Polizza: <span id="lifensure-numero-polizza">--</span></h5>
        <p style="margin-bottom: 0;">I documenti della polizza sono stati inviati all'indirizzo email indicato.</p>
      </div>
      
      <div style="background-color: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 25px;">
        <h6 style="font-weight: 600; margin-bottom: 15px;">Documenti disponibili:</h6>
        <div id="lifensure-documenti-polizza">
          <!-- Documenti inseriti dinamicamente -->
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 30px;">
        <a href="index.html" style="background-color: #0d6efd; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px; cursor: pointer; text-decoration: none; display: inline-block;">
          Torna alla Home
        </a>
      </div>
    </div>
    
    <!-- STEP 5: Errore -->
    <div id="lifensure-step-5" style="display: none;">
      <div style="text-align: center; margin-bottom: 30px;">
        <div style="width: 80px; height: 80px; margin: 0 auto; margin-bottom: 20px; font-size: 60px; color: #dc3545;">
          ⚠
        </div>
        <h3 style="color: #dc3545; font-size: 22px; margin-bottom: 10px;">Si è verificato un errore</h3>
        <p id="lifensure-errore-messaggio" style="font-size: 16px;">Non è stato possibile completare l'operazione</p>
      </div>
      
      <div style="text-align: center; margin-top: 30px;">
        <button id="lifensure-riprova" style="background-color: #0d6efd; color: white; border: none; padding: 10px 20px; border-radius: 4px; font-size: 16px; cursor: pointer; margin-right: 10px;">
          Riprova
        </button>
        <a href="index.html" style="background-color: #f8f9fa; color: #333; border: 1px solid #ced4da; padding: 10px 20px; border-radius: 4px; font-size: 16px; cursor: pointer; text-decoration: none; display: inline-block;">
          Torna alla Home
        </a>
      </div>
    </div>
    
    <!-- Area di debug -->
    <div id="lifensure-debug" style="display: none; margin-top: 30px; padding: 15px; background-color: #f8d7da; color: #842029; border-radius: 4px;">
      <h5 style="margin-bottom: 10px;">Debug Info:</h5>
      <div id="lifensure-debug-content"></div>
    </div>
  </div>
  
  <!-- Finestre modali -->
  <div id="lifensure-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: 9999;">
    <div id="lifensure-modal" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 600px; background-color: white; border-radius: 8px; padding: 20px; max-height: 80vh; overflow-y: auto;">
      <div id="lifensure-modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
        <h5 id="lifensure-modal-title" style="font-size: 18px; margin: 0; font-weight: 600;">Titolo</h5>
        <button id="lifensure-modal-close" style="background: none; border: none; font-size: 24px; cursor: pointer; line-height: 1;">×</button>
      </div>
      <div id="lifensure-modal-content" style="margin-bottom: 20px;">
        <!-- Contenuto modale -->
      </div>
      <div id="lifensure-modal-footer" style="text-align: right; padding-top: 10px; border-top: 1px solid #eee;">
        <button id="lifensure-modal-confirm" style="background-color: #0d6efd; color: white; border: none; padding: 8px 16px; border-radius: 4px; font-size: 16px; cursor: pointer;">
          Ho compreso
        </button>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  // Funzione per la gestione sicura del log
  function safeLog(message) {
    if (window.console && console.log) {
      console.log("[Lifensure Module] " + message);
    }
  }
  
  // Funzione per aggiungere debug info visibile
  function debugInfo(message) {
    try {
      var debugContainer = document.getElementById("lifensure-debug");
      var debugContent = document.getElementById("lifensure-debug-content");
      
      if (debugContainer && debugContent) {
        debugContainer.style.display = "block";
        var time = new Date().toLocaleTimeString();
        var debugLine = document.createElement("p");
        debugLine.style.margin = "5px 0";
        debugLine.textContent = time + ": " + message;
        debugContent.appendChild(debugLine);
      }
    } catch (err) {
      safeLog("Error in debug: " + err.message);
    }
  }
  
  // Inizializza il modulo dopo che il documento è completamente caricato
  function initEmissionModule() {
    try {
      safeLog("Initializing emission module");
      
      // Elementi di navigazione
      var progressBar = document.getElementById("lifensure-progress-bar");
      var steps = [
        document.getElementById("lifensure-step-1"),
        document.getElementById("lifensure-step-2"),
        document.getElementById("lifensure-step-3"),
        document.getElementById("lifensure-step-4"),
        document.getElementById("lifensure-step-5")
      ];
      
      // Verifica che tutti gli step siano stati trovati
      for (var i = 0; i < steps.length; i++) {
        if (!steps[i]) {
          debugInfo("Step " + (i+1) + " non trovato!");
          return;
        }
      }
      
      // Mostra solo il primo step all'inizio
      for (var i = 0; i < steps.length; i++) {
        steps[i].style.display = i === 0 ? "block" : "none";
      }
      
      // Elementi di input
      var offertaId = document.getElementById("lifensure-offerta-id");
      var emailConferma = document.getElementById("lifensure-email-conferma");
      var metodoPagamento = document.getElementById("lifensure-metodo-pagamento");
      
      // Bottoni
      var verificaBtn = document.getElementById("lifensure-verifica-btn");
      var indietroRiepilogoBtn = document.getElementById("lifensure-indietro-riepilogo");
      var procediBtn = document.getElementById("lifensure-procedi-btn");
      var indietroPagamentoBtn = document.getElementById("lifensure-indietro-pagamento");
      var confermaPagamentoBtn = document.getElementById("lifensure-conferma-pagamento");
      var riprovaBtn = document.getElementById("lifensure-riprova");
      
      // Elementi del modal
      var overlay = document.getElementById("lifensure-overlay");
      var modalTitle = document.getElementById("lifensure-modal-title");
      var modalContent = document.getElementById("lifensure-modal-content");
      var modalCloseBtn = document.getElementById("lifensure-modal-close");
      var modalConfirmBtn = document.getElementById("lifensure-modal-confirm");
      
      // Altri elementi
      var datiEbill = document.getElementById("lifensure-dati-ebill");
      var datiBonifico = document.getElementById("lifensure-dati-bonifico");
      var condizioniLink = document.getElementById("lifensure-condizioni-link");
      var privacyLink = document.getElementById("lifensure-privacy-link");
      
      // Funzione per navigare tra gli step
      function goToStep(stepIndex) {
        try {
          safeLog("Navigating to step " + (stepIndex + 1));
          
          // Nascondi tutti gli step
          for (var i = 0; i < steps.length; i++) {
            steps[i].style.display = "none";
          }
          
          // Mostra lo step corrente
          steps[stepIndex].style.display = "block";
          
          // Aggiorna la barra di avanzamento (ignora lo step di errore)
          if (stepIndex < 4) {
            var progressPercentage = (stepIndex / 3) * 100;
            progressBar.style.width = progressPercentage + "%";
          }
          
          // Scroll to top
          window.scrollTo(0, 0);
        } catch (err) {
          debugInfo("Errore nella navigazione: " + err.message);
        }
      }
      
      // Funzione per validare gli input
      function validateInputs(step) {
        try {
          var isValid = true;
          
          if (step === 0) {
            // Validazione step 1: ID offerta e email
            var offertaIdError = document.getElementById("lifensure-offerta-id-error");
            var emailError = document.getElementById("lifensure-email-error");
            
            if (!offertaId.value.trim()) {
              offertaIdError.style.display = "block";
              offertaId.style.borderColor = "#dc3545";
              isValid = false;
            } else {
              offertaIdError.style.display = "none";
              offertaId.style.borderColor = "#ced4da";
            }
            
            var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailConferma.value.trim() || !emailPattern.test(emailConferma.value.trim())) {
              emailError.style.display = "block";
              emailConferma.style.borderColor = "#dc3545";
              isValid = false;
            } else {
              emailError.style.display = "none";
              emailConferma.style.borderColor = "#ced4da";
            }
          } else if (step === 1) {
            // Validazione step 2: checkbox
            var condizioniCheck = document.getElementById("lifensure-condizioni-check");
            var privacyCheck = document.getElementById("lifensure-privacy-check");
            var dichiarazioneCheck = document.getElementById("lifensure-dichiarazione-check");
            
            var condizioniError = document.getElementById("lifensure-condizioni-error");
            var privacyError = document.getElementById("lifensure-privacy-error");
            var dichiarazioneError = document.getElementById("lifensure-dichiarazione-error");
            
            if (!condizioniCheck.checked) {
              condizioniError.style.display = "block";
              isValid = false;
            } else {
              condizioniError.style.display = "none";
            }
            
            if (!privacyCheck.checked) {
              privacyError.style.display = "block";
              isValid = false;
            } else {
              privacyError.style.display = "none";
            }
            
            if (!dichiarazioneCheck.checked) {
              dichiarazioneError.style.display = "block";
              isValid = false;
            } else {
              dichiarazioneError.style.display = "none";
            }
          } else if (step === 2) {
            // Validazione step 3: metodo pagamento
            var pagamentoError = document.getElementById("lifensure-pagamento-error");
            
            if (!metodoPagamento.value) {
              pagamentoError.style.display = "block";
              metodoPagamento.style.borderColor = "#dc3545";
              isValid = false;
            } else {
              pagamentoError.style.display = "none";
              metodoPagamento.style.borderColor = "#ced4da";
            }
          }
          
          return isValid;
        } catch (err) {
          debugInfo("Errore nella validazione: " + err.message);
          return false;
        }
      }
      
      // Funzione per mostrare il modal
      function showModal(title, content) {
        try {
          modalTitle.textContent = title;
          modalContent.innerHTML = content;
          overlay.style.display = "block";
        } catch (err) {
          debugInfo("Errore nell'apertura del modal: " + err.message);
        }
      }
      
      // Funzione per chiudere il modal
      function closeModal() {
        try {
          overlay.style.display = "none";
        } catch (err) {
          debugInfo("Errore nella chiusura del modal: " + err.message);
        }
      }
      
      // Funzioni per gestire le operazioni principali
      function verificaOfferta() {
        try {
          if (!validateInputs(0)) {
            return;
          }
          
          // Modifica il bottone durante il caricamento
          verificaBtn.innerHTML = '<span style="display: inline-block; width: 16px; height: 16px; border: 2px solid white; border-radius: 50%; border-top-color: transparent; animation: lifensure-spin 1s linear infinite;"></span> Verifica in corso...';
          verificaBtn.disabled = true;
          
          // Simulazione di chiamata API (in un'implementazione reale, qui andrà la chiamata API effettiva)
          setTimeout(function() {
            try {
              // Ripristina il bottone
              verificaBtn.innerHTML = 'Verifica offerta';
              verificaBtn.disabled = false;
              
              // Dati offerta di esempio
              var offertaData = {
                nome: "Mario Rossi",
                durata: 10,
                copertura: 100000,
                premioAnnuale: 145.50,
                modalitaPagamento: "annual"
              };
              
              // Mostra riepilogo
              var riepilogoContent = document.getElementById("lifensure-riepilogo-content");
              riepilogoContent.innerHTML = `
                <div style="margin-bottom: 10px; font-weight: 600; font-size: 18px;">Riepilogo dei dettagli</div>
                <div style="display: flex; flex-wrap: wrap;">
                  <div style="flex: 1; min-width: 200px; margin-bottom: 10px;">
                    <p style="margin-bottom: 5px;"><strong>Assicurato:</strong> ${offertaData.nome}</p>
                    <p style="margin-bottom: 5px;"><strong>Durata:</strong> ${offertaData.durata} anni</p>
                  </div>
                  <div style="flex: 1; min-width: 200px; margin-bottom: 10px;">
                    <p style="margin-bottom: 5px;"><strong>Copertura:</strong> CHF ${offertaData.copertura.toLocaleString()}</p>
                    <p style="margin-bottom: 5px;"><strong>Modalità di pagamento:</strong> ${offertaData.modalitaPagamento === "annual" ? "Annuale" : "Mensile"}</p>
                  </div>
                </div>
                <div style="background-color: #cfe2ff; color: #084298; padding: 10px; border-radius: 4px; margin-top: 10px;">
                  <strong>Premio annuale:</strong> CHF ${offertaData.premioAnnuale.toFixed(2)}
                </div>
              `;
              
              // Vai allo step successivo
              goToStep(1);
            } catch (err) {
              debugInfo("Errore nel processare la risposta: " + err.message);
              verificaBtn.innerHTML = 'Verifica offerta';
              verificaBtn.disabled = false;
              
              // Mostra errore
              var erroreMessaggio = document.getElementById("lifensure-errore-messaggio");
              erroreMessaggio.textContent = "Si è verificato un errore durante la verifica dell'offerta. Riprova più tardi.";
              goToStep(4); // Step di errore
            }
          }, 1500);
        } catch (err) {
          debugInfo("Errore nella verifica dell'offerta: " + err.message);
          verificaBtn.innerHTML = 'Verifica offerta';
          verificaBtn.disabled = false;
        }
      }
      
      function procediEmissione() {
        try {
          if (!validateInputs(1)) {
            return;
          }
          
          // Prepara il riepilogo del pagamento
          var riepilogoPagamento = document.getElementById("lifensure-riepilogo-pagamento");
          riepilogoPagamento.innerHTML = `
            <div style="display: flex; flex-wrap: wrap;">
              <div style="flex: 1; min-width: 200px; margin-bottom: 10px;">
                <p style="margin-bottom: 5px;"><strong>Premio da pagare:</strong> CHF 145.50</p>
              </div>
              <div style="flex: 1; min-width: 200px; margin-bottom: 10px;">
                <p style="margin-bottom: 5px;"><strong>Scadenza pagamento:</strong> 7 giorni</p>
              </div>
            </div>
          `;
          
          // Vai allo step successivo
          goToStep(2);
        } catch (err) {
          debugInfo("Errore nel procedere con l'emissione: " + err.message);
        }
      }
      
      function confermaPagamento() {
        try {
          if (!validateInputs(2)) {
            return;
          }
          
          // Modifica il bottone durante il caricamento
          confermaPagamentoBtn.innerHTML = '<span style="display: inline-block; width: 16px; height: 16px; border: 2px solid white; border-radius: 50%; border-top-color: transparent; animation: lifensure-spin 1s linear infinite;"></span> Elaborazione...';
          confermaPagamentoBtn.disabled = true;
          
          // Simulazione di chiamata API (in un'implementazione reale, qui andrà la chiamata API effettiva)
          setTimeout(function() {
            try {
              // Ripristina il bottone
              confermaPagamentoBtn.innerHTML = 'Conferma pagamento';
              confermaPagamentoBtn.disabled = false;
              
              // Dati policy di esempio
              var polizzaData = {
                policy_number: "SPP-0010-" + Math.floor(Math.random() * 1000).toString().padStart(3, '0'),
                document_pointers: [
                  {
                    description: "Polizza SPP-0010-022",
                    document_id: "0",
                    pointer: "52616E646F6D495679FD78396"
                  },
                  {
                    description: "Condizioni Generali di Assicurazione",
                    document_id: "1",
                    pointer: "52616E646F6D495679FD78397"
                  }
                ]
              };
              
              // Aggiorna il numero di polizza
              var numeroPolizza = document.getElementById("lifensure-numero-polizza");
              numeroPolizza.textContent = polizzaData.policy_number;
              
              // Genera lista documenti
              var documentiPolizza = document.getElementById("lifensure-documenti-polizza");
              var documentiHTML = "";
              
              for (var i = 0; i < polizzaData.document_pointers.length; i++) {
                var doc = polizzaData.document_pointers[i];
                documentiHTML += `
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <span>${doc.description}</span>
                    <a href="#" onclick="window.lifensureDownloadDocument('${doc.pointer}', '${doc.description}'); return false;" 
                       style="background-color: #f8f9fa; color: #0d6efd; border: 1px solid #0d6efd; padding: 5px 10px; border-radius: 4px; font-size: 14px; text-decoration: none; display: inline-block;">
                      &#8595; Scarica
                    </a>
                  </div>
                `;
                
                if (i < polizzaData.document_pointers.length - 1) {
                  documentiHTML += '<hr style="margin: 10px 0; border: 0; border-top: 1px solid #eee;">';
                }
              }
              
              documentiPolizza.innerHTML = documentiHTML;
              
              // Vai allo step di completamento
              goToStep(3);
            } catch (err) {
              debugInfo("Errore nel processare la conferma: " + err.message);
              confermaPagamentoBtn.innerHTML = 'Conferma pagamento';
              confermaPagamentoBtn.disabled = false;
              
              // Mostra errore
              var erroreMessaggio = document.getElementById("lifensure-errore-messaggio");
              erroreMessaggio.textContent = "Si è verificato un errore durante l'emissione della polizza. Riprova più tardi.";
              goToStep(4); // Step di errore
            }
          }, 2000);
        } catch (err) {
          debugInfo("Errore nella conferma del pagamento: " + err.message);
          confermaPagamentoBtn.innerHTML = 'Conferma pagamento';
          confermaPagamentoBtn.disabled = false;
        }
      }
      
      function mostraDettagliPagamento() {
        try {
          var metodo = metodoPagamento.value;
          
          // Nascondi tutti i dettagli
          datiEbill.style.display = "none";
          datiBonifico.style.display = "none";
          
          // Mostra i dettagli del metodo selezionato
          if (metodo === "e-bill") {
            datiEbill.style.display = "block";
          } else if (metodo === "bonifico") {
            datiBonifico.style.display = "block";
            var causaleBonifico = document.getElementById("lifensure-causale-bonifico");
            causaleBonifico.textContent = "Polizza SPP-0010-XXX";
          }
        } catch (err) {
          debugInfo("Errore nella visualizzazione dettagli pagamento: " + err.message);
        }
      }
      
      // Funzione per il download del documento (simulata)
      window.lifensureDownloadDocument = function(pointer, description) {
        try {
          alert("Download del documento \"" + description + "\" avviato.");
          // In un'implementazione reale, qui andrebbe la chiamata API per il download effettivo
        } catch (err) {
          debugInfo("Errore nel download del documento: " + err.message);
        }
      };
      
      // Aggiungi gestori di eventi
      if (verificaBtn) {
        verificaBtn.addEventListener("click", verificaOfferta);
      } else {
        debugInfo("Bottone verifica non trovato!");
      }
      
      if (indietroRiepilogoBtn) {
        indietroRiepilogoBtn.addEventListener("click", function() {
          goToStep(0);
        });
      }
      
      if (procediBtn) {
        procediBtn.addEventListener("click", procediEmissione);
      }
      
      if (indietroPagamentoBtn) {
        indietroPagamentoBtn.addEventListener("click", function() {
          goToStep(1);
        });
      }
      
      if (confermaPagamentoBtn) {
        confermaPagamentoBtn.addEventListener("click", confermaPagamento);
      }
      
      if (riprovaBtn) {
        riprovaBtn.addEventListener("click", function() {
          goToStep(0);
        });
      }
      
      if (metodoPagamento) {
        metodoPagamento.addEventListener("change", mostraDettagliPagamento);
      }
      
      if (condizioniLink) {
        condizioniLink.addEventListener("click", function(e) {
          e.preventDefault();
          showModal("Condizioni Generali di Assicurazione", `
            <p>Le presenti Condizioni Generali di Assicurazione regolano il contratto tra il Contraente e Squarelife Insurance AG.</p>
            <h6 style="font-weight: 600; margin-top: 15px;">1. Definizioni</h6>
            <p>1.1 Assicuratore: Squarelife Insurance AG, con sede in Liechtenstein.</p>
            <p>1.2 Contraente: la persona fisica o giuridica che stipula il contratto di assicurazione.</p>
            <p>1.3 Assicurato: la persona fisica sulla cui vita è stipulata l'assicurazione.</p>
            <!-- Altri termini delle condizioni -->
          `);
        });
      }
      
      if (privacyLink) {
        privacyLink.addEventListener("click", function(e) {
          e.preventDefault();
          showModal("Informativa sulla Privacy", `
            <p>Ai sensi del Regolamento UE 2016/679 (GDPR), forniamo le seguenti informazioni sul trattamento dei dati personali.</p>
            <h6 style="font-weight: 600; margin-top: 15px;">1. Titolare del trattamento</h6>
            <p>Il titolare del trattamento è Squarelife Insurance AG, con sede in Liechtenstein.</p>
            <h6 style="font-weight: 600; margin-top: 15px;">2. Finalità del trattamento</h6>
            <p>I dati personali sono trattati per le seguenti finalità:</p>
            <ul style="padding-left: 20px;">
              <li>Emissione e gestione della polizza assicurativa</li>
              <li>Adempimento di obblighi legali e regolamentari</li>
              <li>Prevenzione di frodi assicurative</li>
              <li>Esercizio o difesa di diritti in sede giudiziaria</li>
            </ul>
          `);
        });
      }
      
      if (modalCloseBtn) {
        modalCloseBtn.addEventListener("click", closeModal);
      }
      
      if (modalConfirmBtn) {
        modalConfirmBtn.addEventListener("click", closeModal);
      }
      
      // Aggiungi CSS per l'animazione dello spinner
      var styleElement = document.createElement("style");
      styleElement.textContent = `
        @keyframes lifensure-spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `;
      document.head.appendChild(styleElement);
      
      safeLog("Emission module initialized successfully");
    } catch (err) {
      // In caso di errore, mostra il messaggio di debug
      debugInfo("Errore critico nell'inizializzazione: " + err.message);
    }
  }
  
  // Inizializza il modulo dopo un breve ritardo per assicurarsi che tutti gli elementi siano caricati
  setTimeout(function() {
    initEmissionModule();
  }, 500);
})();
</script></div>


<script src="assets/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/smoothscroll/smooth-scroll.js"></script>
  <script src="assets/ytplayer/index.js"></script>
      <script src="assets/dropdown/js/navbar-dropdown.js"></script>
  <script src="assets/theme/js/script.js"></script>
  
  
  <script src="assets/js/api-handler.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const formPremio = document.getElementById('form-calcolo-premio');
    const risultatoPremio = document.getElementById('risultato-premio');
    
    if (formPremio) {
        formPremio.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Mostra l'area risultati e aggiungi indicatore di caricamento
            risultatoPremio.classList.remove('d-none');
            risultatoPremio.innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Calcolo in corso...</span></div><p class="mt-2">Calcolo del premio in corso...</p></div>';
            
            // Raccogli dati dal form
            const dati = {
                dataNascita: document.getElementById('data-nascita').value,
                fumatore: document.getElementById('fumatore').checked,
                durata: document.getElementById('durata').value,
                copertura: document.getElementById('copertura').value,
                altezza: document.getElementById('altezza').value || null,
                peso: document.getElementById('peso').value || null
            };
            
            try {
                // Chiama l'API
                const risultato = await calcolaPremio(dati);
                
                // Mostra il risultato
                if (risultato.errore) {
                    risultatoPremio.innerHTML = `
                        <div class="alert alert-danger">
                            <h5>Si è verificato un errore</h5>
                            <p>${risultato.errore}</p>
                        </div>`;
                } else {
                    // Estrai il premio dalla risposta
                    const premio = risultato.premium[0].yearly_gross_premium;
                    const currency = risultato.currency || 'CHF';
                    
                    risultatoPremio.innerHTML = `
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <h4 class="card-title">Il tuo preventivo</h4>
                                <p class="card-text">In base ai dati forniti, il premio annuale è:</p>
                                <h2 class="text-primary mb-4">${premio.toLocaleString()} ${currency}</h2>
                                <p class="small text-muted mb-3">Copertura: ${parseInt(dati.copertura).toLocaleString()} ${currency} | Durata: ${dati.durata} anni</p>
                                <button id="btn-richiedi-offerta" class="btn btn-success">Richiedi offerta completa</button>
                            </div>
                        </div>`;
                        
                    // Memorizza i dati per il passaggio successivo
                    sessionStorage.setItem('datiPreventivo', JSON.stringify({
                        ...dati,
                        premio: premio,
                        currency: currency
                    }));
                    
                    // Aggiungi listener al pulsante "Richiedi offerta"
                    document.getElementById('btn-richiedi-offerta').addEventListener('click', function() {
                        window.location.href = 'richiesta-offerta.html'; // Cambia con il percorso corretto alla tua pagina di offerta
                    });
                }
            } catch (errore) {
                risultatoPremio.innerHTML = `
                    <div class="alert alert-danger">
                        <h5>Si è verificato un errore durante la connessione</h5>
                        <p>Non è stato possibile contattare il server. Riprova più tardi.</p>
                        <p class="small text-muted">${errore.message}</p>
                    </div>`;
            }
        });
    }
});
</script>
<script>"use strict";if("loading"in HTMLImageElement.prototype){document.querySelectorAll('img[loading="lazy"]').forEach(e=>{e.src=e.dataset.src;if(e.getAttribute("style")){e.setAttribute("data-temp-style",e.getAttribute("style"))};if(e.getAttribute("data-aspectratio")){e.style.paddingTop=100*e.getAttribute("data-aspectratio")+"%";e.style.height=0;}e.onload=function(){if(e.getAttribute("data-temp-style")){e.setAttribute("style", e.getAttribute("data-temp-style"))}else{e.removeAttribute("style")};e.removeAttribute("data-temp-style")}})}else{const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js";document.body.appendChild(e)}</script>

</body>
</html>